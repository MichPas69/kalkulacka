<!DOCTYPE html>
<html lang="sk">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Kalkulačka – Plyn vs. Tepelné čerpadlo</title>

<style>
  :root{ --brand:#D60000; --dark:#111; --bg:#F6F7F9; }
  html,body{margin:0;padding:0;font-family:Inter,Segoe UI,Roboto,Arial,sans-serif;background:#fff;color:#111}
  .wrap{max-width:1100px;margin:28px auto;padding:0 16px}
  .frame{background:#fff;border:1px solid #e6e6e6;border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,.06);padding:20px}
  .grid{display:grid;grid-template-columns:1fr;gap:16px}
  @media(min-width:980px){ .grid{grid-template-columns:1fr 1fr} }
  .card{background:#fff;border:1px solid #eee;border-radius:14px;padding:16px}
  h2{font-size:18px;margin:.2em 0 .6em}
  label{display:block;font-weight:700;margin-top:10px}
  input[type="number"], select{width:100%;padding:10px;border:1px solid #ddd;border-radius:10px;font-size:15px;margin-top:4px}
  .muted{color:#666;font-size:13px}
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;border-bottom:1px solid #eee;text-align:left}
  tfoot td{font-weight:800}
  .right{text-align:right}
  .total{font-size:20px}
  .kpi{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:12px}
  .kpi .box{background:var(--bg);border:1px solid #e8e8e8;border-radius:12px;padding:12px}
  .kpi .box b{display:block;font-size:12px;color:#555}
  .kpi .box span{font-size:20px;font-weight:800}
  .cta{margin-top:12px;display:flex;gap:10px;flex-wrap:wrap}
  .btn{background:var(--brand);border:none;color:#fff;padding:10px 14px;border-radius:10px;font-weight:800;text-transform:uppercase;cursor:pointer}
  .btn.secondary{background:#444}

  @media print{
    .cta, .card input, .card select { display:none !important; }
    .grid{grid-template-columns:1fr !important}
    .wrap{max-width:900px}
    .frame{box-shadow:none;border:1px solid #ddd}
    .kpi .box{background:#fff}
    a{color:inherit;text-decoration:none}
  }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
</head>
<body>
<div class="wrap">

  <!-- Nadpis a popis -->
  <h1 style="font-size:26px; font-weight:800; margin-bottom:4px; text-align:center;">
    Koľko ušetrím s tepelným čerpadlom oproti plynovému kotlu?
  </h1>
  <p style="color:#777; font-size:14px; text-align:center; max-width:700px; margin:0 auto 20px;">
    Zadajte ročnú spotrebu plynu a ceny. Kalkulačka preráta plyn na kWh, vypočíta náklady a porovná ich 
    s nákladmi na tepelné čerpadlo (SCOP). Výsledok je orientačný.
  </p>

  <div class="frame" id="exportArea">
    <div class="grid">
      <div class="card">
        <h2>1) Plyn – vstupy</h2>
        <label>Ročná spotreba plynu (m³)</label>
        <input id="gas_m3" type="number" value="1500">

        <label>Spodná výhrevnosť (kWh/m³)</label>
        <input id="calorific" type="number" value="10.5">

        <label>Účinnosť kotla (%)</label>
        <input id="boiler_eff" type="number" value="90">

        <label>Cena plynu (€/m³)</label>
        <input id="gas_price" type="number" value="0.75">

        <label>Fixný mesačný poplatok plynu (€/mes.)</label>
        <input id="gas_fixed" type="number" value="5">
      </div>

      <div class="card">
        <h2>2) Tepelné čerpadlo – vstupy</h2>
        <label>SCOP/COP</label>
        <select id="scop">
          <option value="2.8">2.8</option>
          <option value="3.2" selected>3.2</option>
          <option value="3.6">3.6</option>
          <option value="4.0">4.0</option>
        </select>

        <label>Cena elektriny (€/kWh)</label>
        <input id="elec_price" type="number" value="0.18">

        <label>Pokrytie FVE pre TČ (%)</label>
        <input id="pv" type="number" value="20">

        <label>Dotácia na TČ (€)</label>
        <input id="hp_grant" type="number" value="0">

        <label>Investícia do TČ (€)</label>
        <input id="hp_invest" type="number" value="0">
      </div>

      <div class="card" style="grid-column:1/-1">
        <h2>Výsledok</h2>
        <div class="kpi">
          <div class="box"><b>Plyn – energia</b><span id="gas_kwh">0 kWh</span></div>
          <div class="box"><b>Užitočné teplo</b><span id="heat_kwh">0 kWh</span></div>
          <div class="box"><b>TČ – el. spotreba</b><span id="hp_kwh">0 kWh</span></div>
        </div>

        <table style="margin-top:12px">
          <tbody id="rows"></tbody>
          <tfoot>
            <tr><td><b>Ročné náklady plynu (spolu)</b></td><td class="right" id="gas_total">0 €</td></tr>
            <tr><td><b>Ročné náklady TČ (spolu)</b></td><td class="right" id="hp_total">0 €</td></tr>
            <tr><td class="total">Ročná úspora s TČ</td><td class="right total" id="savings">0 €</td></tr>
            <tr><td><b>Návratnosť investície</b></td><td class="right" id="payback">–</td></tr>
          </tfoot>
        </table>

        <div class="cta">
          <button class="btn" id="pdfBtn" style="background:#0B5;">Stiahnuť PDF</button>
          <button class="btn secondary" id="resetBtn">Reset</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  const COMPANY = {
    name: "SPEKTRA INSTALL",
    phone: "+421 917 572 221",
    email: "spektrainstall@gmail.com",
    web: "www.spektrainstall.sk"
  };
  // URL vodotlače – vlož sem cestu k svojmu logu
  const WATERMARK_URL = "https://www.spektrainstall.sk/wp-content/uploads/logo-spektra.png";

  function eur(n){ return n.toLocaleString('sk-SK',{style:'currency',currency:'EUR'}); }
  function kwh(x){ return Math.round(x).toLocaleString('sk-SK') + ' kWh'; }
  function el(id){ return document.getElementById(id); }

  function calc(){
    var gas_m3   = +el('gas_m3').value||0;
    var H        = +el('calorific').value||10.5;
    var eff      = (+el('boiler_eff').value||90)/100;
    var gas_p    = +el('gas_price').value||0;
    var gas_fix  = +el('gas_fixed').value||0;
    var SCOP     = +el('scop').value||3.2;
    var el_p     = +el('elec_price').value||0.18;
    var pv       = Math.min(100,Math.max(0,+el('pv').value||0))/100;
    var invest   = +el('hp_invest').value||0;
    var grant    = +el('hp_grant').value||0;

    var gas_energy_kWh = gas_m3 * H;
    var useful_heat    = gas_energy_kWh * eff;

    var gas_total = gas_m3 * gas_p + (gas_fix * 12);

    var hp_kwh = (SCOP>0) ? (useful_heat / SCOP) : 0;
    var hp_paid_kwh = hp_kwh * (1 - pv);
    var hp_total = hp_paid_kwh * el_p;

    var savings = Math.max(0, gas_total - hp_total);
    var net_invest = Math.max(0, invest - grant);
    var payback = (savings > 0 && net_invest > 0) ? (net_invest / savings).toFixed(1).replace('.', ',') + ' r.' : '–';

    el('gas_kwh').textContent  = kwh(gas_energy_kWh);
    el('heat_kwh').textContent = kwh(useful_heat);
    el('hp_kwh').textContent   = kwh(hp_kwh);

    var rows = [
      ['Plyn: spotreba', gas_m3 + ' m³'],
      ['Plyn: energia', kwh(gas_energy_kWh)],
      ['Kotol: účinnosť', Math.round(eff*100) + ' %'],
      ['Užitočné teplo', kwh(useful_heat)],
      ['Plyn: cena za m³', eur(gas_p) + ' / m³'],
      ['Plyn: fixná zložka (12×)', eur(gas_fix*12)],
      ['TČ: SCOP', SCOP.toFixed(1)],
      ['TČ: el. spotreba', kwh(hp_kwh)],
      ['FVE pokrytie', Math.round(pv*100) + ' %'],
      ['Elektrina: cena', eur(el_p) + ' / kWh']
    ];
    el('rows').innerHTML = rows.map(r => `<tr><td>${r[0]}</td><td class="right">${r[1]}</td></tr>`).join('');

    el('gas_total').textContent = eur(gas_total);
    el('hp_total').textContent  = eur(hp_total);
    el('savings').textContent   = eur(savings);
    el('payback').textContent   = payback;

    return {savings, net_invest, payback};
  }

  document.querySelectorAll('input,select').forEach(i=>{
    i.addEventListener('input', calc);
    i.addEventListener('change', calc);
  });

  document.getElementById('pdfBtn').addEventListener('click', async function(){
    calc();
    const target = document.getElementById('exportArea');
    const { jsPDF } = window.jspdf;
    const canvas = await html2canvas(target,{scale:2,useCORS:true});
    const pdf = new jsPDF('p','mm','a4');
    const pageW = pdf.internal.pageSize.getWidth();
    const pageH = pdf.internal.pageSize.getHeight();
    const margin = 10;
    const imgW = pageW - margin*2;
    const imgH = canvas.height * (imgW / canvas.width);
    
    // pridanie hlavného obsahu
    pdf.addImage(canvas.toDataURL('image/png'),'PNG',margin,margin,imgW,imgH);

    // vodotlač
    if (WATERMARK_URL) {
      const wmImg = await loadImage(WATERMARK_URL);
      const wmW = 80; // mm
      const wmH = wmImg.height * (wmW / wmImg.width);
      pdf.setGState(new pdf.GState({opacity:0.08}));
      pdf.addImage(wmImg, 'PNG', (pageW - wmW) / 2, (pageH - wmH) / 2, wmW, wmH);
      pdf.setGState(new pdf.GState({opacity:1}));
    }

    // kontakt firmy
    pdf.setFontSize(9);
    pdf.text(`${COMPANY.name} • ${COMPANY.phone} • ${COMPANY.email} • ${COMPANY.web}`, margin, pageH - 6);

    pdf.save('Spektra_kalkulacka.pdf');
  });

  async function loadImage(url) {
    return new Promise((resolve, reject) => {
      const img = new Image();
      img.crossOrigin = "anonymous";
      img.onload = () => resolve(img);
      img.onerror = reject;
      img.src = url;
    });
  }

  document.getElementById('resetBtn').addEventListener('click', function(){
    var def = {gas_m3:1500, calorific:10.5, boiler_eff:90, gas_price:0.75, gas_fixed:5, scop:3.2, elec_price:0.18, pv:20, hp_grant:0, hp_invest:0};
    Object.keys(def).forEach(k => el(k).value = def[k]);
    calc();
  });

  calc();
})();
</script>
</body>
</html>
