<!DOCTYPE html>
<html lang="sk">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Porovnávacia kalkulačka vykurovania – Spektra Install</title>
    <!-- Tailwind CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React + ReactDOM (UMD) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <!-- Babel to allow JSX in-browser (quick deploy) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
      @media print {
        .print\:hidden { display: none !important; }
        body { background: #fff !important; }
      }
    </style>
  </head>
  <body class="bg-[#F6F7F9] text-slate-900">
    <div id="spektra-heating-calc-root" class="min-h-screen"></div>

    <script type="text/babel">
      const { useState, useMemo, useEffect } = React;

      const fmtEur  = (n) => n.toLocaleString('sk-SK', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 });
      const fmtEur3 = (n) => n.toLocaleString('sk-SK', { style: 'currency', currency: 'EUR', maximumFractionDigits: 3 });

      const DEFAULTS = {
        heatDemand: 20000,
        electricityPrice: 0.16,
        gasPricePerKWh: 0.09,
        pelletsPricePerTon: 320,
        woodPricePerPrm: 100,
        hpSCOP: 3.8,
        effElectric: 1.0,
        effGas: 0.92,
        effPellets: 0.88,
        effWood: 0.80,
        pelletsKWhPerTon: 4800,
        woodKWhPerPrm: 1900,
        fveSharePct: 0,
        fvePrice: 0.00,
      };

      const STORAGE_KEY = 'heating_calc_inputs_v1';

      function Card({ title, subtitle, children }) {
        return (
          <div className="rounded-2xl border bg-white p-4 shadow-sm">
            <div className="mb-3">
              <div className="font-semibold">{title}</div>
              {subtitle && <div className="text-xs text-slate-600">{subtitle}</div>}
            </div>
            {children}
          </div>
        );
      }

      function NumberRow({ label, value, onChange, step = 1, decimals = 0, hint }) {
        return (
          <label className="flex flex-col gap-1 mb-2">
            <span className="text-sm text-slate-700">{label}</span>
            <input
              type="number"
              step={step}
              value={value}
              onChange={(e) => onChange(Number(e.target.value))}
              className="px-3 py-2 rounded-xl border outline-none focus:ring-2 focus:ring-blue-500"
            />
            <span className="text-[11px] text-slate-500">{hint ?? `krok ${step}, desatinné miesta ${decimals}`}</span>
          </label>
        );
      }

      function HeatingCalculator(){
        const [inputs, setInputs] = useState(() => {
          try {
            const fromUrl = new URLSearchParams(window.location.search);
            if (fromUrl.size) {
              const base = { ...DEFAULTS };
              for (const [k, v] of fromUrl.entries()) {
                if (k in base) base[k] = Number(v);
              }
              return base;
            }
            const raw = localStorage.getItem(STORAGE_KEY);
            return raw ? { ...DEFAULTS, ...JSON.parse(raw) } : DEFAULTS;
          } catch {
            return DEFAULTS;
          }
        });

        const [company, setCompany] = useState({
          name: 'Spektra Install',
          sidlo: 'Rajecká Lesná 98, 013 15',
          prevadzka: 'Hollého 210, Rajec 01501',
          web: 'www.spektrainstall.sk',
          phone: '+421 917 572 221',
          email: 'spektrainstall@gmail.com',
        });

        useEffect(()=>{ localStorage.setItem(STORAGE_KEY, JSON.stringify(inputs)); }, [inputs]);

        const hpElecPrice = useMemo(()=>{
          const share = Math.min(Math.max(inputs.fveSharePct / 100, 0), 1);
          return inputs.electricityPrice * (1 - share) + inputs.fvePrice * share;
        }, [inputs.electricityPrice, inputs.fveSharePct, inputs.fvePrice]);

        const results = useMemo(()=>{
          const heat = inputs.heatDemand;
          const priceHPkWh    = hpElecPrice / inputs.hpSCOP;
          const priceEleckWh  = inputs.electricityPrice / inputs.effElectric;
          const priceGaskWh   = inputs.gasPricePerKWh / inputs.effGas;
          const pricePelletkWh= inputs.pelletsPricePerTon / (inputs.pelletsKWhPerTon * inputs.effPellets);
          const priceWoodkWh  = inputs.woodPricePerPrm / (inputs.woodKWhPerPrm * inputs.effWood);

          const rows = [
            { key: 'hp',      label: 'Tepelné čerpadlo',   cpk: priceHPkWh,     annual: priceHPkWh * heat,     note: `SCOP ${inputs.hpSCOP}` },
            { key: 'elec',    label: 'Elektrický kotol',   cpk: priceEleckWh,   annual: priceEleckWh * heat,   note: `účinnosť ${(inputs.effElectric * 100).toFixed(0)}%` },
            { key: 'gas',     label: 'Plynový kotol',      cpk: priceGaskWh,    annual: priceGaskWh * heat,    note: `účinnosť ${(inputs.effGas * 100).toFixed(0)}%` },
            { key: 'pellets', label: 'Kotol na pelety',    cpk: pricePelletkWh, annual: pricePelletkWh * heat, note: `účinnosť ${(inputs.effPellets * 100).toFixed(0)}%` },
            { key: 'wood',    label: 'Kotol na drevo',     cpk: priceWoodkWh,   annual: priceWoodkWh * heat,   note: `účinnosť ${(inputs.effWood * 100).toFixed(0)}%` },
          ];
          rows.sort((a,b)=>a.annual-b.annual);
          return rows;
        }, [inputs, hpElecPrice]);

        const cheapest = results[0]?.key;
        const set = (patch) => setInputs(s=>({ ...s, ...patch }));
        const copyShareUrl = async () => {
          const qs = new URLSearchParams();
          Object.entries(inputs).forEach(([k,v])=>qs.set(k, String(v)));
          const url = `${location.origin}${location.pathname}?${qs.toString()}`;
          await navigator.clipboard.writeText(url);
          alert('Odkaz s nastaveniami skopírovaný do schránky.');
        };
        const handlePrint = () => window.print();
        const reset = () => setInputs(DEFAULTS);

        return (
          <div className="min-h-screen bg-[#F6F7F9] text-slate-900 py-10">
            <div className="max-w-6xl mx-auto px-4">
              <header className="mb-6">
                <div className="rounded-2xl overflow-hidden border shadow-sm">
                  <div className="bg-[#111] text-white px-5 py-3 flex items-center justify-between">
                    <div className="flex items-center gap-3">
                      <div className="w-9 h-9 rounded-full bg-[#D60000] grid place-items-center font-bold">S</div>
                      <div>
                        <div className="text-sm uppercase tracking-widest text-slate-300">{company.name}</div>
                        <div className="text-xs text-slate-400">Sídlo: {company.sidlo} • Prevádzka: {company.prevadzka}</div>
                        <div className="text-xs text-slate-400">{company.web} {company.phone && `• ${company.phone}`} {company.email && `• ${company.email}`}</div>
                      </div>
                    </div>
                    <div className="hidden md:flex gap-2 print:hidden">
                      <button onClick={copyShareUrl} className="px-3 py-2 rounded-xl bg-blue-600 text-white hover:bg-blue-700 shadow-sm">Zdieľať nastavenia</button>
                      <button onClick={handlePrint} className="px-3 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700 shadow-sm">Tlačiť / PDF</button>
                      <button onClick={reset} className="px-3 py-2 rounded-xl bg-slate-200 hover:bg-slate-300">Reset</button>
                    </div>
                  </div>
                  <div className="bg-white px-5 py-4">
                    <h1 className="text-2xl md:text-3xl font-bold tracking-tight">Porovnávacia kalkulačka vykurovania</h1>
                    <p className="text-sm md:text-base text-slate-600">Elektrický kotol • Drevo • Tepelné čerpadlo • Plyn • Pelety</p>
                  </div>
                </div>

                <div className="mt-3 flex gap-2 md:hidden print:hidden">
                  <button onClick={copyShareUrl} className="flex-1 px-3 py-2 rounded-xl bg-blue-600 text-white">Zdieľať</button>
                  <button onClick={handlePrint} className="flex-1 px-3 py-2 rounded-xl bg-emerald-600 text-white">Tlačiť / PDF</button>
                  <button onClick={reset} className="flex-1 px-3 py-2 rounded-xl bg-slate-200">Reset</button>
                </div>
              </header>

              <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4 mb-8">
                <Card title="Firemné kontakty" subtitle="Tieto údaje sa zobrazia v hlavičke a pätičke">
                  <label className="text-xs text-slate-600">Telefón</label>
                  <input className="px-3 py-2 rounded-xl border mb-2" placeholder="+421 ..." value={company.phone} onChange={e=>setCompany({...company, phone:e.target.value})} />
                  <label className="text-xs text-slate-600">E-mail</label>
                  <input className="px-3 py-2 rounded-xl border mb-2" placeholder="info@spektrainstall.sk" value={company.email} onChange={e=>setCompany({...company, email:e.target.value})} />
                </Card>

                <Card title="Ročná potreba tepla" subtitle="kWh/rok vrátane kúrenia a TÚV">
                  <NumberRow label="Teplo (kWh/rok)" value={inputs.heatDemand} step={500} onChange={(v)=>set({heatDemand:v})} />
                </Card>

                <Card title="Elektrina">
                  <NumberRow label="Cena elektriny (€/kWh)" value={inputs.electricityPrice} step={0.01} decimals={3} onChange={(v)=>set({electricityPrice:v})} />
                  <NumberRow label="Účinnosť el. kotla" value={inputs.effElectric} step={0.01} decimals={2} onChange={(v)=>set({effElectric:v})} hint="typicky 1.00" />
                </Card>

                <Card title="Tepelné čerpadlo" subtitle="SCOP uprav podľa teplotného režimu">
                  <NumberRow label="SCOP (sezónny)" value={inputs.hpSCOP} step={0.1} decimals={1} onChange={(v)=>set({hpSCOP:v})} />
                  <div className="mt-2 text-xs text-slate-600">Tip: podlahovka 35–40 °C ≈ SCOP 3.8–4.5, radiátory 50–55 °C ≈ 2.8–3.5</div>
                  <div className="mt-4 border-t pt-3">
                    <NumberRow label="Pokrytie TČ z FVE (%)" value={inputs.fveSharePct} step={5} decimals={0} onChange={(v)=>set({fveSharePct:v})} />
                    <NumberRow label="Cena vlastnej FVE (€/kWh)" value={inputs.fvePrice} step={0.01} decimals={3} onChange={(v)=>set({fvePrice:v})} hint="ak 0, tak zdarma" />
                    <div className="text-xs text-slate-600">Efektívna cena el. pre TČ: {fmtEur3(hpElecPrice)} /kWh</div>
                  </div>
                </Card>

                <Card title="Plynový kotol">
                  <NumberRow label="Cena plynu (€/kWh paliva)" value={inputs.gasPricePerKWh} step={0.005} decimals={3} onChange={(v)=>set({gasPricePerKWh:v})} />
                  <NumberRow label="Účinnosť kotla" value={inputs.effGas} step={0.01} decimals={2} onChange={(v)=>set({effGas:v})} hint="kondenzačný ~0.90–0.98" />
                </Card>

                <Card title="Kotol na pelety">
                  <NumberRow label="Cena peliet (€/t)" value={inputs.pelletsPricePerTon} step={10} onChange={(v)=>set({pelletsPricePerTon:v})} />
                  <NumberRow label="Výhrevnosť (kWh/t)" value={inputs.pelletsKWhPerTon} step={100} onChange={(v)=>set({pelletsKWhPerTon:v})} />
                  <NumberRow label="Účinnosť kotla" value={inputs.effPellets} step={0.01} decimals={2} onChange={(v)=>set({effPellets:v})} />
                </Card>

                <Card title="Kotol na drevo">
                  <NumberRow label="Cena dreva (€/prm)" value={inputs.woodPricePerPrm} step={5} onChange={(v)=>set({woodPricePerPrm:v})} />
                  <NumberRow label="Výhrevnosť (kWh/prm)" value={inputs.woodKWhPerPrm} step={50} onChange={(v)=>set({woodKWhPerPrm:v})} />
                  <NumberRow label="Účinnosť kotla" value={inputs.effWood} step={0.01} decimals={2} onChange={(v)=>set({effWood:v})} />
                </Card>
              </div>

              <section className="mb-8">
                <h2 className="text-xl font-semibold mb-3">Výsledky – cena tepla a ročné náklady</h2>
                <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                  {results.map((r) => (
                    <div key={r.key} className={`rounded-2xl border bg-white p-4 shadow-sm ${r.key===cheapest?"ring-2 ring-green-500":""}`}>
                      <div className="flex items-center justify-between mb-2">
                        <h3 className="font-bold text-lg">{r.label}</h3>
                        {r.key===cheapest && <span className="text-xs px-2 py-1 rounded-full bg-green-100 text-green-700">Najlacnejšie</span>}
                      </div>
                      <div className="text-sm text-slate-600 mb-4">{r.note}</div>
                      <div className="text-sm">Cena tepla:</div>
                      <div className="text-2xl font-semibold">{fmtEur3(r.cpk)} <span className="text-base font-normal text-slate-600">/ kWh</span></div>
                      <div className="mt-3 text-sm">Ročné náklady (pri {inputs.heatDemand.toLocaleString('sk-SK')} kWh):</div>
                      <div className="text-xl font-semibold">{fmtEur(r.annual)}</div>
                    </div>
                  ))}
                </div>
              </section>

              <section className="text-xs md:text-sm text-slate-600 space-y-2">
                <p>
                  Poznámka: Výpočty sú okamžité a prehľadné, ale orientačné. Zadaj svoje reálne ceny (tarifa, poplatky, nákupné ceny palív),
                  uprav účinnosti podľa typu zariadenia a teplotného režimu. SCOP je sezónna hodnota – vyššie prívodné teploty znižujú SCOP.
                </p>
                <p>
                  Zdieľanie: Nastavenia môžeš zdieľať tlačidlom „Zdieľať nastavenia“ – URL obsahuje všetky vstupy. Vstupy sa tiež ukladajú lokálne (localStorage).
                </p>
              </section>

              <footer className="mt-10 text-center text-xs text-slate-500">
                © {new Date().getFullYear()} {company.name} • {company.prevadzka} • {company.phone || "+421 ..."} • {company.web}
              </footer>
            </div>
          </div>
        );
      }

      ReactDOM.createRoot(document.getElementById('spektra-heating-calc-root')).render(<HeatingCalculator />);
    </script>
  </body>
</html>
